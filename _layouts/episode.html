---
layout: default
---

<section class="ep">
  <!-- Hero (cover + title/meta/player) -->
  <div class="wrap ep-hero">
    {% if page.cover %}
      <div class="ep-cover">
        <img src="{{ page.cover }}" alt="Episode cover for {{ page.title }}">
      </div>
    {% endif %}

    <div class="ep-head">
      <h1 class="ep-title">{{ page.title }}</h1>

      <p class="ep-meta muted">
        {{ page.date | date: "%B %-d, %Y" }}
        {% if page.duration %} · {{ page.duration }}{% endif %}
        {% assign s = page.season | default: page.itunes_season %}
        {% assign e = page.episode | default: page.itunes_episode %}
        {% if s %} · S{{ s }}{% endif %}
        {% if e %} · EP {{ e }}{% endif %}
      </p>

      {% if page.audio_url %}
        <audio class="ep-audio" controls preload="none" src="{{ page.audio_url }}"></audio>
      {% endif %}
    </div>
  </div>

  <!-- Body (full description + actions) -->
  <div class="wrap ep-body">
    {% comment %}
      Prefer full content. Strip the old placeholder if it exists.
      Fallback to description/excerpt if content is empty.
    {% endcomment %}
    {% assign cleaned = content | replace: 'Imported automatically from RSS.', '' | strip %}
    {% if cleaned == '' %}
      {% assign cleaned = page.description | default: page.excerpt | default: '' %}
    {% endif %}

    <div class="prose ep-prose">
      {{ cleaned | markdownify }}
    </div>

    <!-- Actions: one Share button + your existing platform icons -->
    <div class="ep-actions">
      <button
        class="pill outline share-btn"
        type="button"
        data-title="{{ page.title | escape }}"
        data-url="{{ page.url | absolute_url }}"
      >
        Share
      </button>

      {% include social-icons.html %}
    </div>
  </div>
</section>

<script>
  // Single "Share" button: uses Web Share API when available,
  // falls back to copying the URL to the clipboard.
  (function () {
    const btn = document.querySelector('.share-btn');
    if (!btn) return;

    const url = btn.dataset.url || location.href;
    const title = btn.dataset.title || document.title;

    async function fallbackCopy() {
      try {
        await navigator.clipboard.writeText(url);
        const original = btn.textContent;
        btn.textContent = 'Link copied!';
        setTimeout(() => (btn.textContent = original), 1400);
      } catch (_) {
        // swallow
      }
    }

    btn.addEventListener('click', async () => {
      if (navigator.share) {
        try { await navigator.share({ title, url }); }
        catch (_) { /* user cancelled */ }
      } else {
        fallbackCopy();
      }
    });
  })();
</script>
