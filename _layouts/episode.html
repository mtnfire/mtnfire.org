---
layout: default
---

<section class="ep">
  <!-- Hero (cover + title/meta/player) -->
  <div class="wrap ep-hero">
    {% if page.cover %}
      <div class="ep-cover">
        <img src="{{ page.cover }}" alt="Episode cover for {{ page.title }}">
      </div>
    {% endif %}

    <div class="ep-head">
      <h1 class="ep-title">{{ page.title }}</h1>

      <p class="ep-meta muted">
        {{ page.date | date: "%B %-d, %Y" }}
        {% if page.duration %} · {{ page.duration }}{% endif %}
        {% assign s = page.season | default: page.itunes_season %}
        {% assign e = page.episode | default: page.itunes_episode %}
        {% if s %} · S{{ s }}{% endif %}
        {% if e %} · EP {{ e }}{% endif %}
      </p>

      {% if page.audio_url %}
        <audio class="ep-audio" controls preload="none" src="{{ page.audio_url }}"></audio>
      {% endif %}
    </div>
  </div>

  <!-- Body (full description + actions) -->
  <div class="wrap ep-body">
    {% comment %}
      Prefer Markdown body if present.
      Otherwise, pick first non-empty among common RSS fields, unescaping HTML entities if needed.
    {% endcomment %}

    {%- assign body_md = content | replace: 'Imported automatically from RSS.', '' | strip -%}
    {%- assign final = '' -%}

    {%- if body_md != '' -%}
      {%- assign final = body_md | markdownify -%}
    {%- else -%}
      {%- assign keys = "description|description_html|content_html|content|summary|itunes_summary|long_summary|subtitle|itunes_subtitle|encoded|encoded_content|content_encoded|summary_html" | split: "|" -%}
      {%- assign picked = '' -%}
      {%- for k in keys -%}
        {%- assign v = page[k] -%}
        {%- if picked == '' and v and v != '' -%}
          {%- assign picked = v -%}
        {%- endif -%}
      {%- endfor -%}

      {%- if picked != '' -%}
        {%- assign unescaped = picked
          | replace: '&lt;','<'
          | replace: '&gt;','>'
          | replace: '&amp;','&'
          | replace: '&quot;','"'
          | replace: '&#39;', "'" -%}

        {%- if unescaped contains '<' -%}
          {%- assign final = unescaped -%}  {# already HTML #}
        {%- else -%}
          {%- assign final = unescaped | markdownify -%}
        {%- endif -%}
      {%- endif -%}
    {%- endif -%}

    <div class="prose ep-prose">
      {{ final }}
    </div>

    <!-- Actions: one Share button + your existing platform icons -->
    <div class="ep-actions">
      <button
        class="pill outline share-btn"
        type="button"
        data-title="{{ page.title | escape }}"
        data-url="{{ page.url | absolute_url }}"
      >
        Share
      </button>

      {% include social-icons.html %}
    </div>
  </div>
</section>

<script>
  // Single "Share" button: uses Web Share API when available,
  // falls back to copying the URL to the clipboard.
  (function () {
    const btn = document.querySelector('.share-btn');
    if (!btn) return;

    const url = btn.dataset.url || location.href;
    const title = btn.dataset.title || document.title;

    async function fallbackCopy() {
      try {
        await navigator.clipboard.writeText(url);
        const original = btn.textContent;
        btn.textContent = 'Link copied!';
        setTimeout(() => (btn.textContent = original), 1400);
      } catch (_) {}
    }

    btn.addEventListener('click', async () => {
      if (navigator.share) {
        try { await navigator.share({ title, url }); }
        catch (_) {}
      } else {
        fallbackCopy();
      }
    });
  })();
</script>
